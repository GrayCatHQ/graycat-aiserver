<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Architecture | Velesio AI Server</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Architecture" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A microservice-based AI inference server with Redis queue-based worker architecture" />
<meta property="og:description" content="A microservice-based AI inference server with Redis queue-based worker architecture" />
<link rel="canonical" href="http://0.0.0.0:4000/velesio-aiserver/architecture.html" />
<meta property="og:url" content="http://0.0.0.0:4000/velesio-aiserver/architecture.html" />
<meta property="og:site_name" content="Velesio AI Server" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Architecture" />
<meta name="twitter:site" content="@Velesio" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A microservice-based AI inference server with Redis queue-based worker architecture","headline":"Architecture","url":"http://0.0.0.0:4000/velesio-aiserver/architecture.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/velesio-aiserver/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/velesio-aiserver/feed.xml" title="Velesio AI Server" /></head>
<body><header class="site-header" role="banner">
  <div class="header-wrapper">
    <a class="site-title" rel="author" href="/velesio-aiserver/">
      <span class="site-logo">🚀</span>
      Velesio AI Server
    </a>

    <div class="header-actions">
      <!-- Theme toggle -->
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <svg class="theme-icon sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4V2c0-.6-.4-1-1-1s-1 .4-1 1v2c0 .6.4 1 1 1s1-.4 1-1zM12 22v-2c0-.6-.4-1-1-1s-1 .4-1 1v2c0 .6.4 1 1 1s1-.4 1-1zM20 13h2c.6 0 1-.4 1-1s-.4-1-1-1h-2c-.6 0-1 .4-1 1s.4 1 1 1zM4 13H2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1z"/>
        </svg>
        <svg class="theme-icon moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
          <path d="M21 12.8c-.2 4.9-4.3 8.8-9.2 8.6C6.8 21.2 2.8 17.1 3 12.2 3.2 7.3 7.3 3.4 12.2 3.6c.5 0 1 .1 1.4.2-.4.4-.7.9-1 1.4-.9 1.6-.9 3.5 0 5.1.4.8 1 1.4 1.8 1.8 1.6.9 3.5.9 5.1 0 .5-.3 1-.6 1.4-1 .1.5.1.9.1 1.4z"/>
        </svg>
      </button>

      <!-- GitHub link -->
      <a class="github-link" href="https://github.com/Velesio/Velesio-aiserver" target="_blank" rel="noopener" aria-label="View on GitHub">
        <svg class="github-icon" width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
      </a>

      <!-- Mobile menu toggle -->
      <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>
</header>

<style>
.site-header {
  background-color: var(--header-bg);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 1000;
  backdrop-filter: blur(8px);
}

.site-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-color);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.site-logo {
  font-size: 1.2rem;
}

.site-nav {
  .page-link {
    color: var(--text-secondary);
    text-decoration: none;
    margin-left: 1.5rem;
    font-weight: 500;
    transition: color 0.2s ease;
    
    &:hover {
      color: var(--text-color);
    }
    
    &.github-link {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      
      .github-icon {
        fill: currentColor;
      }
    }
  }
  
  .nav-trigger {
    display: none;
  }
  
  .menu-icon {
    display: none;
  }
  
  .trigger {
    display: flex;
    align-items: center;
  }
}

@media screen and (max-width: 600px) {
  .site-nav {
    position: absolute;
    top: 9px;
    right: 15px;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    text-align: right;
    
    label[for="nav-trigger"] {
      display: block;
      float: right;
      width: 36px;
      height: 36px;
      z-index: 2;
      cursor: pointer;
    }
    
    .menu-icon {
      display: block;
      float: right;
      width: 36px;
      height: 26px;
      line-height: 0;
      padding-top: 10px;
      text-align: center;
      
      > svg {
        fill: var(--text-color);
      }
    }
    
    input ~ .trigger {
      clear: both;
      display: none;
      flex-direction: column;
      align-items: flex-start;
      padding: 10px;
    }
    
    input:checked ~ .trigger {
      display: flex;
    }
    
    .page-link {
      display: block;
      padding: 5px 10px;
      margin-left: 0;
      margin-bottom: 5px;
      
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
}
</style><main class="page-content" aria-label="Content">
      <div class="page-layout"><nav class="sidebar" id="sidebar">
  <div class="sidebar-content">
    <ul class="sidebar-nav">
      
      
      <li class="nav-item">
        <a href="/velesio-aiserver/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
          Home
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/getting-started.html" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
          Getting Started
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/deployment.html" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm6 16H8a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h2v1a1 1 0 0 0 2 0V9h2v12a1 1 0 0 1-1 1z"/>
          </svg>
          Deployment
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/architecture.html" class="nav-link active">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Architecture
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/api-reference.html" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
          </svg>
          API Reference
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/model-templates.html" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 4h16v2H4V4zm0 6h10v2H4v-2zm0 6h16v2H4v-2z"/>
          </svg>
          Model Templates
        </a>
      </li>

      <li class="nav-item">
        <a href="/velesio-aiserver/troubleshooting.html" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
          </svg>
          Troubleshooting
        </a>
      </li>
      
      <li class="nav-section">
        <span class="section-title">Components</span>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/components/api-service/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          API Service
        </a>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/components/gpu-workers/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
          </svg>
          GPU Workers
        </a>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/components/monitoring/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2.5 7h-13v-2h13v2z"/>
            <path d="M11 2v2H7V2h4zm0 20v-2H7v2h4zm2-20v2h4V2h-4zm0 20v-2h4v2h-4z"/>
          </svg>
          Monitoring Stack
        </a>
      </li>
      
      <li class="nav-section">
        <span class="section-title">Unity Integrations</span>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/unity-integrations/llm-integration/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 6h-1v8c0 .55-.45 1-1 1H6v1c0 1.1.9 2 2 2h10l4 4V8c0-1.1-.9-2-2-2zm-3 5V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v13l4-4h11c1.1 0 2-.9 2-2z"/>
          </svg>
          LLM for Unity Integration
        </a>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/unity-integrations/stable-diffusion-integration/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 17l3.5-4.5 2.5 3.01L14.5 11l4.5 6H5z"/>
          </svg>
          Stable Diffusion for Unity
        </a>
      </li>
      
      <li class="nav-item">
        <a href="/velesio-aiserver/unity-integrations/dnd-generator/" class="nav-link ">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          DND Generator
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Sidebar overlay for mobile -->
<div class="sidebar-overlay" id="sidebar-overlay"></div><div class="main-content">
    <div class="wrapper">
      <article class="post">
        <header class="post-header">
          <h1 class="post-title">Architecture</h1></header>

        <div class="post-content">
          <h1 id="architecture-overview">Architecture Overview</h1>

<p>Velesio AI Server follows a microservice architecture designed for scalability, reliability, and maintainability.</p>

<h2 id="system-architecture">System Architecture</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre>┌─────────────────────────────────────────────────────────────┐
│                     Client Applications                      │
│  (Unity Games, Web Apps, Mobile Apps, CLI Tools, etc.)     │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP/REST API
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                   API Gateway                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────────┐│
│  │   FastAPI   │ │    Auth     │ │    Request Validation   ││
│  │   Server    │ │  Middleware │ │      &amp; Routing          ││
│  └─────────────┘ └─────────────┘ └─────────────────────────┘│
└─────────────────────┬───────────────────────────────────────┘
                      │ Job Queue
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  Message Broker                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                   Redis Queue                           ││
│  │  • Job queuing &amp; distribution                           ││
│  │  • Result storage &amp; retrieval                           ││
│  │  • Worker coordination                                  ││
│  └─────────────────────────────────────────────────────────┘│
└─────────┬───────────────────────────────┬───────────────────┘
          │                               │
          │ Pull Jobs                     │ Pull Jobs
          │                               │
┌─────────▼─────────────┐      ┌─────────▼─────────────────────┐
│    LLM Worker         │      │  Stable Diffusion Worker     │
│  ┌─────────────────┐  │      │  ┌─────────────────────────┐  │
│  │ undreamai_server│  │      │  │    Automatic1111        │  │
│  │ (llama.cpp fork)│  │      │  │      WebUI              │  │
│  └─────────────────┘  │      │  └─────────────────────────┘  │
│  ┌─────────────────┐  │      │  ┌─────────────────────────┐  │
│  │  GGUF Models    │  │      │  │  Stable Diffusion      │  │
│  │     (Text)      │  │      │  │      Models             │  │
│  └─────────────────┘  │      │  └─────────────────────────┘  │
└───────────────────────┘      └───────────────────────────────┘
          │                               │
          └─────────────┬─────────────────┘
                        │ Results
                        │
┌─────────────────────▼─────────────────────────────────────────┐
│                 Monitoring Stack                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────────┐  │
│  │  Prometheus │ │   Grafana   │ │      Log Aggregation    │  │
│  │   Metrics   │ │ Dashboards  │ │        (Loki)           │  │
│  └─────────────┘ └─────────────┘ └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="independent-components">Independent Components</h2>

<p>Velesio AI Server consists of <strong>three independent, deployable components</strong> that can run together or separately:</p>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Description</th>
      <th>Documentation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>🌐 <strong><a href="/velesio-aiserver/components/api-service">API Service</a></strong></td>
      <td>FastAPI gateway handling HTTP requests and job queuing</td>
      <td><code class="language-plaintext highlighter-rouge">api/</code></td>
    </tr>
    <tr>
      <td>🎮 <strong><a href="/velesio-aiserver/components/gpu-workers">GPU Workers</a></strong></td>
      <td>AI inference engines for LLM and Stable Diffusion</td>
      <td><code class="language-plaintext highlighter-rouge">gpu/</code></td>
    </tr>
    <tr>
      <td>📊 <strong><a href="/velesio-aiserver/components/monitoring">Monitoring Stack</a></strong></td>
      <td>Observability with Grafana dashboards and metrics</td>
      <td><code class="language-plaintext highlighter-rouge">monitoring/</code></td>
    </tr>
  </tbody>
</table>

<p>Each component can be:</p>
<ul>
  <li><strong>Deployed together</strong> for a complete, integrated solution</li>
  <li><strong>Deployed separately</strong> across multiple servers for scalability</li>
  <li><strong>Mixed and matched</strong> based on your infrastructure requirements</li>
</ul>

<h2 id="core-components">Core Components</h2>

<h3 id="1-api-gateway-fastapi">1. API Gateway (FastAPI)</h3>

<p><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">api/</code></p>

<p>The API Gateway serves as the entry point for all client requests:</p>

<ul>
  <li><strong>Authentication</strong>: Bearer token validation</li>
  <li><strong>Request Validation</strong>: Pydantic models ensure data integrity</li>
  <li><strong>Job Queuing</strong>: Converts HTTP requests to Redis jobs</li>
  <li><strong>Response Handling</strong>: Polls Redis for job results and returns to clients</li>
  <li><strong>Documentation</strong>: Auto-generated OpenAPI docs at <code class="language-plaintext highlighter-rouge">/docs</code></li>
</ul>

<p><strong>Key Features</strong>:</p>
<ul>
  <li>Async/await for high concurrency</li>
  <li>Structured logging</li>
  <li>Health checks</li>
  <li>Rate limiting (configurable)</li>
  <li>CORS support for web clients</li>
</ul>

<h3 id="2-message-broker-redis">2. Message Broker (Redis)</h3>

<p><strong>Technology</strong>: Redis with RQ (Redis Queue)</p>

<p>Redis serves multiple roles:</p>

<ul>
  <li><strong>Job Queue</strong>: Stores pending inference jobs</li>
  <li><strong>Result Storage</strong>: Temporary storage for completed results</li>
  <li><strong>Worker Coordination</strong>: Manages worker pool and load balancing</li>
  <li><strong>Session Management</strong>: Optional session state for stateful conversations</li>
</ul>

<p><strong>Queue Structure</strong>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>llama_queue:
├── pending_jobs    # Jobs waiting for workers
├── active_jobs     # Currently processing jobs  
├── completed_jobs  # Finished jobs (TTL: 1 hour)
└── failed_jobs     # Failed jobs for debugging
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-gpu-workers">3. GPU Workers</h3>

<h4 id="llm-worker-gpullmpy">LLM Worker (<code class="language-plaintext highlighter-rouge">gpu/llm.py</code>)</h4>

<p><strong>Core Technology</strong>: <code class="language-plaintext highlighter-rouge">undreamai_server</code> (custom llama.cpp fork)</p>

<ul>
  <li><strong>Model Format</strong>: GGUF (GPT-Generated Unified Format)</li>
  <li><strong>Inference Engine</strong>: Custom llama.cpp binary optimized for undream.ai</li>
  <li><strong>GPU Acceleration</strong>: CUDA with configurable layer offloading</li>
  <li><strong>Context Management</strong>: Configurable context windows (2K-32K tokens)</li>
</ul>

<p><strong>Features</strong>:</p>
<ul>
  <li>Streaming text generation</li>
  <li>Configurable sampling parameters</li>
  <li>Multi-turn conversation support</li>
  <li>Memory-efficient attention mechanisms</li>
</ul>

<h4 id="stable-diffusion-worker-gpusdpy">Stable Diffusion Worker (<code class="language-plaintext highlighter-rouge">gpu/sd.py</code>)</h4>

<p><strong>Core Technology</strong>: Automatic1111 WebUI</p>

<ul>
  <li><strong>Model Format</strong>: Safetensors, CKPT</li>
  <li><strong>Inference Engine</strong>: Diffusers + PyTorch</li>
  <li><strong>Acceleration</strong>: xFormers, Flash Attention</li>
  <li><strong>Extensions</strong>: LoRA, ControlNet, VAE support</li>
</ul>

<p><strong>Features</strong>:</p>
<ul>
  <li>Text-to-image generation</li>
  <li>Image-to-image transformation</li>
  <li>Inpainting and outpainting</li>
  <li>Batch processing</li>
  <li>Custom model loading</li>
</ul>

<h3 id="4-monitoring-stack-optional-component">4. Monitoring Stack (Optional Component)</h3>

<p><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">monitoring/</code><br />
<strong>Deployment</strong>: Independent, can run separately or alongside main application</p>

<p>The monitoring stack is a <strong>standalone component</strong> that provides comprehensive observability across all system components. It can be deployed:</p>

<ul>
  <li><strong>Integrated</strong>: Alongside the main application for unified monitoring</li>
  <li><strong>Centralized</strong>: On a dedicated monitoring server for multiple Velesio instances</li>
  <li><strong>Development</strong>: Locally for debugging and performance analysis</li>
</ul>

<h4 id="prometheus">Prometheus</h4>
<ul>
  <li><strong>Metrics Collection</strong>: System, Redis, GPU, and custom application metrics</li>
  <li><strong>Alerting</strong>: Configurable alerts for system health and performance</li>
  <li><strong>Data Retention</strong>: Configurable retention (default: 200h of metric history)</li>
  <li><strong>Remote Monitoring</strong>: Can monitor multiple Velesio deployments from a central location</li>
</ul>

<h4 id="grafana">Grafana</h4>
<ul>
  <li><strong>Pre-configured Dashboards</strong>: Four auto-provisioned dashboards
    <ul>
      <li>Redis performance and queue metrics</li>
      <li>System resources (CPU, memory, disk, network)</li>
      <li>NVIDIA GPU metrics (utilization, memory, temperature, power)</li>
      <li>Centralized log viewing and analysis</li>
    </ul>
  </li>
  <li><strong>Multi-Instance Support</strong>: Monitor multiple API/GPU worker deployments</li>
  <li><strong>Alerting</strong>: Visual alerts with multiple notification channels</li>
</ul>

<h4 id="exporters--collectors-auto-deployed">Exporters &amp; Collectors (Auto-deployed)</h4>
<ul>
  <li><strong>Node Exporter</strong>: System metrics collection</li>
  <li><strong>Redis Exporter</strong>: Queue and performance metrics</li>
  <li><strong>NVIDIA GPU Exporter</strong>: GPU utilization and health metrics</li>
  <li><strong>Promtail</strong>: Log aggregation from all services</li>
</ul>

<p><strong>Deployment Flexibility</strong>: The monitoring stack can be deployed independently from the main application, making it suitable for:</p>
<ul>
  <li>Multi-environment monitoring (dev, staging, production)</li>
  <li>Cross-datacenter observability</li>
  <li>Centralized monitoring of distributed Velesio deployments</li>
</ul>

<p>For detailed setup and deployment options, see the <a href="/velesio-aiserver/components/monitoring-stack">Monitoring Stack Component</a>.</p>

<h2 id="data-flow">Data Flow</h2>

<h3 id="text-generation-request-flow">Text Generation Request Flow</h3>

<ol>
  <li><strong>Client Request</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>POST /completion
Authorization: Bearer &lt;token&gt;
{
  "prompt": "Write a story about...",
  "max_tokens": 150,
  "temperature": 0.7
}
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li><strong>API Processing</strong>
    <ul>
      <li>Validate bearer token against <code class="language-plaintext highlighter-rouge">API_TOKENS</code></li>
      <li>Validate request schema with Pydantic</li>
      <li>Generate unique job ID</li>
      <li>Enqueue job to Redis <code class="language-plaintext highlighter-rouge">llama_queue</code></li>
    </ul>
  </li>
  <li><strong>Worker Processing</strong>
    <ul>
      <li>LLM worker polls Redis queue</li>
      <li>Loads request parameters</li>
      <li>Calls <code class="language-plaintext highlighter-rouge">undreamai_server</code> binary</li>
      <li>Streams or batches response</li>
      <li>Stores result in Redis with TTL</li>
    </ul>
  </li>
  <li><strong>Response</strong>
    <ul>
      <li>API polls Redis for job completion</li>
      <li>Returns structured OpenAI-compatible response</li>
      <li>Cleans up job data</li>
    </ul>
  </li>
</ol>

<h3 id="image-generation-request-flow">Image Generation Request Flow</h3>

<ol>
  <li><strong>Client Request</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>POST /sdapi/v1/txt2img
Authorization: Bearer &lt;token&gt;
{
  "prompt": "A futuristic cityscape",
  "width": 512,
  "height": 512,
  "steps": 20
}
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li><strong>Processing Similar to Text</strong>, but:
    <ul>
      <li>Job routed to SD worker</li>
      <li>Image generated by Automatic1111 WebUI</li>
      <li>Result encoded as base64</li>
      <li>Metadata included (seed, model, parameters)</li>
    </ul>
  </li>
</ol>

<h2 id="deployment-modes">Deployment Modes</h2>

<h3 id="standalone-mode-remotefalse">Standalone Mode (<code class="language-plaintext highlighter-rouge">REMOTE=false</code>)</h3>
<ul>
  <li>All services run on single machine</li>
  <li>Redis exposed on localhost:6379</li>
  <li>Direct worker access on ports 1337/7860</li>
  <li>Ideal for development and small deployments</li>
</ul>

<h3 id="distributed-mode-remotetrue">Distributed Mode (<code class="language-plaintext highlighter-rouge">REMOTE=true</code>)</h3>
<ul>
  <li>Workers connect to remote Redis instance</li>
  <li>Horizontal scaling of GPU workers</li>
  <li>Load balancing across multiple machines</li>
  <li>Production-ready architecture</li>
</ul>

<h2 id="security-architecture">Security Architecture</h2>

<h3 id="authentication">Authentication</h3>
<ul>
  <li><strong>Bearer Token</strong>: Simple, stateless authentication</li>
  <li><strong>Multi-tenant</strong>: Support for multiple API keys</li>
  <li><strong>Rate Limiting</strong>: Per-token request limits (optional)</li>
</ul>

<h3 id="network-security">Network Security</h3>
<ul>
  <li><strong>Internal Communication</strong>: Services communicate via Docker network</li>
  <li><strong>Firewall</strong>: Only necessary ports exposed</li>
  <li><strong>TLS</strong>: HTTPS termination at reverse proxy (nginx)</li>
</ul>

<h3 id="data-security">Data Security</h3>
<ul>
  <li><strong>No Persistent Storage</strong>: Requests/responses not logged by default</li>
  <li><strong>Memory Isolation</strong>: Workers run in separate containers</li>
  <li><strong>Model Security</strong>: Models stored in protected volumes</li>
</ul>

<h2 id="performance-characteristics">Performance Characteristics</h2>

<h3 id="throughput">Throughput</h3>
<ul>
  <li><strong>LLM</strong>: 10-50 tokens/second (depending on model size)</li>
  <li><strong>Stable Diffusion</strong>: 1-5 images/minute (depending on resolution)</li>
  <li><strong>Concurrent Requests</strong>: Limited by GPU memory and worker count</li>
</ul>

<h3 id="latency">Latency</h3>
<ul>
  <li><strong>API Response</strong>: &lt;100ms for job queuing</li>
  <li><strong>LLM First Token</strong>: 200-500ms (cold start: 2-5s)</li>
  <li><strong>SD Image</strong>: 10-60 seconds depending on parameters</li>
</ul>

<h3 id="scalability">Scalability</h3>
<ul>
  <li><strong>Horizontal</strong>: Add more GPU workers</li>
  <li><strong>Vertical</strong>: Increase GPU memory/compute</li>
  <li><strong>Queue Depth</strong>: Redis handles thousands of queued jobs</li>
</ul>

<h2 id="deployment-patterns">Deployment Patterns</h2>

<p>Velesio AI Server is designed with <strong>component independence</strong> in mind. Each component can be deployed separately or together based on your infrastructure needs:</p>

<h3 id="-monolithic-deployment">🔗 Monolithic Deployment</h3>
<p>Deploy all components on a single server:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span>  <span class="c"># API + GPU Workers + Redis</span>
<span class="nb">cd </span>monitoring <span class="o">&amp;&amp;</span> docker-compose up <span class="nt">-d</span>  <span class="c"># Optional monitoring</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-distributed-deployment">🔲 Distributed Deployment</h3>
<p>Deploy components across multiple servers:</p>

<p><strong>Server 1 (API + Redis)</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># api-only docker-compose.yml</span>
services:
  api:
    <span class="c"># ... API configuration</span>
  redis:
    <span class="c"># ... Redis configuration</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Server 2-N (GPU Workers)</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># gpu-worker docker-compose.yml</span>
services:
  gpu_worker:
    environment:
      - <span class="nv">REMOTE</span><span class="o">=</span><span class="nb">true</span>
      - <span class="nv">REDIS_HOST</span><span class="o">=</span>server1:6379
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Monitoring Server (Optional)</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Central monitoring for all deployments</span>
<span class="nb">cd </span>monitoring
<span class="c"># Configure prometheus.yml with remote targets</span>
docker-compose up <span class="nt">-d</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-hybrid-deployment">🎯 Hybrid Deployment</h3>
<p>Mix local and remote components:</p>
<ul>
  <li>API + Redis locally</li>
  <li>GPU workers on dedicated GPU servers</li>
  <li>Centralized monitoring for multiple environments</li>
</ul>

<h2 id="technology-stack">Technology Stack</h2>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Technology</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>API</td>
      <td>FastAPI + Uvicorn</td>
      <td>High-performance async web framework</td>
    </tr>
    <tr>
      <td>Queue</td>
      <td>Redis + RQ</td>
      <td>Message broker and job queue</td>
    </tr>
    <tr>
      <td>LLM Engine</td>
      <td>undreamai_server</td>
      <td>Custom llama.cpp fork</td>
    </tr>
    <tr>
      <td>SD Engine</td>
      <td>Automatic1111 WebUI</td>
      <td>Feature-rich SD implementation</td>
    </tr>
    <tr>
      <td>Monitoring</td>
      <td>Prometheus + Grafana</td>
      <td>Metrics and visualization</td>
    </tr>
    <tr>
      <td>Orchestration</td>
      <td>Docker Compose</td>
      <td>Service coordination</td>
    </tr>
    <tr>
      <td>Proxy</td>
      <td>Nginx (optional)</td>
      <td>Load balancing and TLS</td>
    </tr>
  </tbody>
</table>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li><a href="api-reference.html">API Reference</a> - Detailed endpoint documentation</li>
  <li><a href="deployment.html">Deployment Guide</a> - Production deployment strategies</li>
  <li><a href="components/">Component Documentation</a> - Deep dive into each service</li>
</ul>

        </div>

        
          <nav class="post-nav">
            
            
            
            
            
            <div class="nav-previous">
              
                
                <a href="/velesio-aiserver/getting-started.html" rel="prev">← Getting Started</a>
              
            </div>
            
            <div class="nav-next">
              
                
                <a href="/velesio-aiserver/components.html" rel="next">Components →</a>
              
            </div>
          </nav>
        

        <!-- Back to top button -->
        <button class="back-to-top" id="back-to-top" aria-label="Back to top">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
          </svg>
        </button>
      </article>
    </div>
  </div>
</div>

<script>
// Set dark theme as default immediately
(function() {
  const savedTheme = localStorage.getItem('theme');
  const theme = savedTheme || 'dark'; // Default to dark
  document.documentElement.setAttribute('data-theme', theme);
  if (!savedTheme) {
    localStorage.setItem('theme', 'dark');
  }
})();
</script>
<script src="/velesio-aiserver/assets/js/main.js"></script>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/velesio-aiserver/"></data>

  <div class="wrapper">
    <div class="footer-content">
      <div class="footer-section">
        <h3 class="footer-heading">Velesio AI Server</h3>
        <p class="footer-description">A microservice-based AI inference server with Redis queue-based worker architecture</p>
        
        <div class="social-links">
          <a href="https://github.com/Velesio/Velesio-aiserver" class="social-link" target="_blank" rel="noopener">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            GitHub
          </a>
          
          
        </div>
      </div>
      
      <div class="footer-section">
        <h4>Documentation</h4>
        <ul class="footer-links">
          <li><a href="/velesio-aiserver/getting-started">Getting Started</a></li>
          <li><a href="/velesio-aiserver/architecture">Architecture</a></li>
          <li><a href="/velesio-aiserver/components">Components</a></li>
          <li><a href="/velesio-aiserver/api-reference">API Reference</a></li>
          <li><a href="/velesio-aiserver/deployment">Deployment</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Resources</h4>
        <ul class="footer-links">
          <li><a href="/velesio-aiserver/troubleshooting">Troubleshooting</a></li>
          <li><a href="https://github.com/Velesio/Velesio-aiserver/issues" target="_blank">Report Issues</a></li>
          <li><a href="https://github.com/Velesio/Velesio-aiserver/discussions" target="_blank">Discussions</a></li>
          <li><a href="https://github.com/Velesio/Velesio-aiserver/releases" target="_blank">Releases</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Built with</h4>
        <div class="tech-stack">
          <span class="tech-badge">FastAPI</span>
          <span class="tech-badge">Docker</span>
          <span class="tech-badge">Redis</span>
          <span class="tech-badge">CUDA</span>
          <span class="tech-badge">Jekyll</span>
        </div>
        
        <div class="footer-meta">
          <p>&copy; 2025 Velesio AI Server. Open source under MIT license.</p>
          <p class="build-info">
            Built with ❤️ using Jekyll
            <br>
            <small>Last updated: September 23, 2025</small>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer><script src="/velesio-aiserver/assets/js/toc.js"></script>
  </body>

</html>